# 索引的调优技巧1

> 索引的调优主要包含以下内容

* 长字段的索引调优
* 使用组合索引的技巧
* 覆盖索引
* 排序的优化
* 冗余、重复索引的优化、

## 长字段索引的调优

### 方案一：

如果我们数据库中的某个字段长度过长，比如varchar类型的字段长度超过200，如果为如此长的字段设置索引，那么这颗索引树所占的空间是比较高的。这种情况下我们可以考虑为此字段添加一个辅助性的字段，比较好的方式就是创建一个存储该字段hash值的列。

这个hash值的列尽可能满足以下要求：

1. hash字段的长度应当比较小，SHA1/MD5这种算法计算出的长度都比较长，计算出的结果并不合适做该字段的辅助列。
2. 应当尽可能避免hash冲突，就目前来数，数据库种流行使用的是***CRC32()***或者***FNV64()***

**局限性**：like 查询无效，因为生成的hash是整个字段的hash

解决方案：创建前缀索引

### 方案二：创建前缀索引

比如我要为first_name字段创建前缀索引：`alter table employees add key(first_name(5))`，这里的5即选取的first_name字段值的前5位来创建索引，那么实际中字段的长度应该如何选取呢？这里有一个公式可以作为参考：***索引的选择性 = 不重复的索引值 / 数据表中的总记录数***，得到的数值越大，选择性越高，性能越好。

完整列的选择性:0.0042[这个字段的最大选择性了

```mysql
select count(distinct first_name)/count(1) from employees
-- 5:0.0038     6:0.0041     7:0.0042
select count(distinct left(first_name, 8))/count(1) from employees
-- 结论: 使用7作为索引长度最好
alter table employees add key(first_name(7))
```

**局限性**：无法做 order by、 group by；无法使用覆盖索引

