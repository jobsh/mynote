# 索引数据结构

## B-Tree

![image-20210321083439349](E:\mynote\mysql\索引数据结构.assets\image-20210321083439349.png)

## B+Tree

![image-20210321083908627](E:\mynote\mysql\索引数据结构.assets\image-20210321083908627.png)

- B+Tree有n个子节点的节点中含有n个关键字
  B-Tree是n个子节点的节点有n-1个关键字

- B+Tree中,所有的**叶子节点**中**包含了全部关键字的信息**,且叶子节点按照关键字的大小自小而大顺序链接,构成一个**有序链表**
  B-Tree的叶子节点不包括全部关键字

- B+Tree 父节点中所有的关键字都会在子节点中体现，比如上图的根节点中包含5、28、65,那么在它的三个子节点中就分别包括5、28、65。

  B-Tree中叶子节点不包含父节点的信息。

- B+Tree中，非叶子节点仅用于索引,不保存数据记录,记录存放在叶子节点中，叶子节点保存所有的数据
  B-Tree中，非叶子节点既保存索引，也保存数据记录。

- 由于B+Tree，非叶子节点只是用于索引，不保存数据，因此和B-Tree相比，相同的空间B+Tree可以存放更多的索引。这样的话，如果相同的空间B+Tree就会显得更加矮胖一些，对磁盘的IO操作也就会减少。

- B+Tree由于叶子节点顺序存储了所有的数据，对于范围查询，B+Tree的查询效率会更高一些（可以一次性取出符合范围的数据）。

## innoDB

* 使用：B+Tree
* **主键索引**:叶子节点存储**主键及数据**
* **非主键索引**(二级索引、辅助索引)：叶子节点存储**索引以及主键，不存储数据**（其实可以把这里的主键可以理解成非主键索引存储的数据）

> 因此，如果你的sql查询语句，使用的是非主键索引，那么会使用非主键索引查询到主键，再利用主键索引查询到数据。

## MyISAM引擎

*  使用:B+Tree
* 主键/非主键索引的叶子节点都是存储指向数据块的指针 —— 索引和数据都是分开存储的

## 聚簇索引、非聚簇索引

* innoDB —— 聚簇索引
* MyISAM —— 非聚簇索引

## Hash索引

* Memory引擎支持显式Hash索引
* INNODB引擎支持"**自适应Hash索引**"，无法自己手动创建Hash索引

当InnODB引擎发现某些索引值使用的非常频繁的话，那么就会在**B+Tree索引之上自动创建一个Hash索引**，成为**自适应Hash索引**。

用 `show variables like innodb_adaptive_hash_index`查看InnoDB hash索引的开关情况，默认是打开的。

## 空间索引（R-Tree索引）

- 存储GIS数据,基于R-Tree
- MYSQL5.7开始 InnoDB支持空间索引

## 全文索引

- 适应全了应全文搜素的需求
- MYSQL5.7之前，全文索引不支持中文搭配Sphinx
- MYSQL5.7起,内置 ngram，支持中文

